version: "3.9"

x-base: &egra_base
  image: nemo_inference_nemo-asr:latest
  build:
    context: .
    dockerfile: docker/Dockerfile
  working_dir: /work
  environment:
    PYTHONUNBUFFERED: "1"
  volumes:
    - ./:/work:rw                               # your repo root (contains main.py, infer.py, etc.)
    - ./input_output_data:/io:rw                # input/output data root
    - ./nemo_inference/models:/models:ro        # .nemo models
    - ./nemo_inference/tmp:/tmp_segments:rw     # temp segments (and kept if debug flag is used)

services:
  nemo-asr:
    <<: *egra_base
    container_name: nemo-asr
    # GPU access is disabled by default to avoid nvidia-container errors on hosts
    # without a properly configured NVIDIA driver / toolkit. To enable GPU, uncomment:
    # gpus: "all"

  egra-eval:
    <<: *egra_base
    container_name: egra-eval
    # gpus: "all"   # not needed for CPU-only eval

